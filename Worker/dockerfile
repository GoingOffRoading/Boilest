FROM alpine
RUN apk add --no-cache python3 py3-pip ffmpeg sqlite bash
RUN pip install --no-cache-dir celery flower

RUN apk update
RUN apk upgrade

# Need to set UID/GID since we're likely interfacing with files owned by a non-root user
ARG UID=1000
ARG GID=1000

RUN mkdir -p /boil_watch
RUN mkdir -p /boil_hold
RUN mkdir -p /Boilest
RUN mkdir -p /Scripts
COPY /Scripts /Scripts
WORKDIR "/Scripts"

# Add a user that is the same user group as the data being read
# Is this clean?  Not really...  Will need to revisit this later
RUN addgroup -g 1000 boil 
RUN adduser -D boil -G boil -u 1000
RUN chown -R boil:boil /boil_watch /boil_hold /Boilest /Scripts
USER boil

EXPOSE 80
EXPOSE 5555

ENTRYPOINT [ "/bin/sh"]
CMD ["/Scripts/Celery.sh"]